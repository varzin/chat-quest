# План разработки Chat Quest

## Фаза 1: Базовая структура

### 1.1 HTML каркас
- [x] Создать index.html с базовой структурой
- [x] Подключить CSS и JS модули
- [x] Добавить meta-теги для мобильных устройств
- [x] Создать семантическую разметку основных областей

### 1.2 CSS основа
- [x] Определить CSS переменные (цвета, шрифты, отступы)
- [x] Стили для dark theme
- [x] Reset/normalize стили
- [x] Базовая типография

## Фаза 2: UI компоненты

### 2.1 Chat View
- [x] Контейнер сообщений со скроллом
- [x] Стили пузырей сообщений (NPC слева, Player справа)
- [x] Аватары персонажей
- [x] Имена над сообщениями с цветом из конфига

### 2.2 Typing Indicator
- [x] Компонент "печатает..." с тремя точками
- [x] CSS анимация пульсации
- [x] Логика расчета задержки по длине сообщения

### 2.3 Choices Panel
- [x] Контейнер кнопок внизу экрана
- [x] Стили кнопок выбора
- [x] Состояния: hover, active
- [x] Анимация появления

### 2.4 Sidebar
- [x] Выдвигающееся меню слева
- [x] Список сценариев
- [x] Кнопка добавления нового сценария
- [x] Кнопка настроек
- [x] Overlay для закрытия
- [x] Анимация открытия/закрытия

### 2.5 Header
- [x] Название текущего сценария
- [x] Кнопка меню (hamburger)
- [x] Кнопка перезапуска сценария

### 2.6 Editor Modal
- [x] Модальное окно на весь экран
- [x] Textarea для YAML+Ink кода
- [x] Кнопки: Сохранить, Отмена
- [x] Базовая валидация при сохранении

## Фаза 3: Ядро приложения

### 3.1 YAML Parser (parser.js)
- [x] Функция извлечения YAML блока
- [x] Парсинг YAML без библиотек (простой парсер)
- [x] Валидация обязательных полей
- [x] Обработка ошибок парсинга

### 3.2 Ink Parser (parser.js)
- [x] Парсинг VAR объявлений
- [x] Парсинг knots (=== name ===)
- [x] Парсинг choices (+ [text])
- [x] Парсинг diverts (-> target)
- [x] Парсинг speaker assignment (~ speaker = "id")
- [x] Построение структуры сценария

### 3.3 Ink Engine (engine.js)
- [x] Инициализация сценария
- [x] Выполнение текущего узла
- [x] Получение текста реплик
- [x] Получение доступных выборов
- [x] Обработка выбора пользователя
- [x] Переход между узлами
- [x] Определение конца сценария (END)
- [x] Сериализация состояния для сохранения

### 3.4 Storage Manager (storage.js)
- [x] Сохранение списка сценариев
- [x] Загрузка сценария по ID
- [x] Удаление сценария
- [x] Автосохранение прогресса
- [x] Загрузка прогресса
- [x] Очистка всех данных

### 3.5 UI Controller (ui.js)
- [x] Инициализация DOM элементов
- [x] Рендеринг сообщения
- [x] Рендеринг кнопок выбора
- [x] Показ/скрытие typing indicator
- [x] Управление sidebar
- [x] Управление модальными окнами
- [x] Автоскролл к новым сообщениям

### 3.6 Локализация (i18n.js)
- [x] Объект строк RU/EN
- [x] Функция получения строки по ключу
- [x] Переключение языка
- [x] Сохранение выбранного языка

### 3.7 Main App (app.js)
- [x] Инициализация приложения
- [x] Связывание модулей
- [x] Обработка событий пользователя
- [x] Game loop (показ сообщений, ожидание выбора)
- [x] Загрузка демо-сценария при первом запуске

## Фаза 4: Контент

### 4.1 Демо-сценарий
- [x] Написать простую историю с ветвлениями
- [x] 9 узлов, множество развилок
- [x] Интересный сюжет для демонстрации
- [x] Валидация по спецификации

### 4.2 Иконки (inline SVG)
- [x] Иконка меню (hamburger)
- [x] Иконка перезапуска
- [x] Иконка добавления
- [x] Иконка настроек
- [x] Иконка удаления
- [x] Иконка редактирования

## Фаза 5: Полировка

### 5.1 Анимации
- [x] Появление сообщений
- [x] Typing indicator
- [x] Открытие/закрытие sidebar
- [x] Кнопки выбора
- [x] Модальные окна

### 5.2 Мобильная адаптация
- [x] Safe area для iPhone (notch)
- [x] Touch-friendly размеры элементов
- [x] Предотвращение zoom при фокусе на input
- [ ] Тестирование на разных размерах экрана

### 5.3 Обработка ошибок
- [x] Ошибки парсинга сценария
- [x] Ошибки localStorage
- [x] Невалидные файлы при загрузке
- [x] Понятные сообщения пользователю

### 5.4 Финальное тестирование
- [ ] Тест полного цикла: загрузка → игра → сохранение → перезапуск
- [ ] Тест всех веток демо-сценария
- [ ] Тест на Chrome, Firefox, Safari
- [ ] Тест на мобильных устройствах

## Статус проекта

**Текущий статус**: MVP реализован
**Следующий шаг**: Тестирование и отладка

## Как запустить

```bash
# Запуск локального сервера
python3 -m http.server 8080
# или
npx serve .

# Затем открыть в браузере
http://localhost:8080
```

## Структура файлов

```
chat-quest/
├── index.html           # Главный HTML файл
├── css/
│   └── styles.css       # Все стили
├── js/
│   ├── app.js           # Главный модуль
│   ├── parser.js        # Парсер YAML + Ink
│   ├── engine.js        # Движок Ink
│   ├── ui.js            # UI контроллер
│   ├── storage.js       # Работа с localStorage
│   └── i18n.js          # Локализация
├── scenarios/
│   └── demo.ink         # Демо-сценарий
├── docs/
│   └── format-spec.md   # Спецификация формата
├── CLAUDE.md            # Документация проекта
└── PROJECT_PLAN.md      # Этот файл
```
