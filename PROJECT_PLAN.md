# План разработки Chat Quest

## Фаза 1: Базовая структура

### 1.1 HTML каркас
- [ ] Создать index.html с базовой структурой
- [ ] Подключить CSS и JS модули
- [ ] Добавить meta-теги для мобильных устройств
- [ ] Создать семантическую разметку основных областей

### 1.2 CSS основа
- [ ] Определить CSS переменные (цвета, шрифты, отступы)
- [ ] Стили для dark theme
- [ ] Reset/normalize стили
- [ ] Базовая типография

## Фаза 2: UI компоненты

### 2.1 Chat View
- [ ] Контейнер сообщений со скроллом
- [ ] Стили пузырей сообщений (NPC слева, Player справа)
- [ ] Аватары персонажей
- [ ] Имена над сообщениями с цветом из конфига
- [ ] Временные метки (опционально)

### 2.2 Typing Indicator
- [ ] Компонент "печатает..." с тремя точками
- [ ] CSS анимация пульсации
- [ ] Логика расчета задержки по длине сообщения

### 2.3 Choices Panel
- [ ] Контейнер кнопок внизу экрана
- [ ] Стили кнопок выбора
- [ ] Состояния: hover, active, disabled
- [ ] Анимация появления

### 2.4 Sidebar
- [ ] Выдвигающееся меню слева
- [ ] Список сценариев
- [ ] Кнопка добавления нового сценария
- [ ] Кнопка настроек
- [ ] Overlay для закрытия
- [ ] Анимация открытия/закрытия

### 2.5 Header
- [ ] Название текущего сценария
- [ ] Кнопка меню (hamburger)
- [ ] Кнопка перезапуска сценария

### 2.6 Editor Modal
- [ ] Модальное окно на весь экран
- [ ] Textarea для YAML+Ink кода
- [ ] Кнопки: Сохранить, Отмена
- [ ] Базовая валидация при сохранении

## Фаза 3: Ядро приложения

### 3.1 YAML Parser (parser.js)
- [ ] Функция извлечения YAML блока
- [ ] Парсинг YAML без библиотек (простой парсер)
- [ ] Валидация обязательных полей
- [ ] Обработка ошибок парсинга

### 3.2 Ink Parser (parser.js)
- [ ] Парсинг VAR объявлений
- [ ] Парсинг knots (=== name ===)
- [ ] Парсинг choices (+ [text])
- [ ] Парсинг diverts (-> target)
- [ ] Парсинг speaker assignment (~ speaker = "id")
- [ ] Построение AST/структуры сценария

### 3.3 Ink Engine (engine.js)
- [ ] Инициализация сценария
- [ ] Выполнение текущего узла
- [ ] Получение текста реплик
- [ ] Получение доступных выборов
- [ ] Обработка выбора пользователя
- [ ] Переход между узлами
- [ ] Определение конца сценария (END)
- [ ] Сериализация состояния для сохранения

### 3.4 Storage Manager (storage.js)
- [ ] Сохранение списка сценариев
- [ ] Загрузка сценария по ID
- [ ] Удаление сценария
- [ ] Автосохранение прогресса
- [ ] Загрузка прогресса
- [ ] Очистка всех данных

### 3.5 UI Controller (ui.js)
- [ ] Инициализация DOM элементов
- [ ] Рендеринг сообщения
- [ ] Рендеринг кнопок выбора
- [ ] Показ/скрытие typing indicator
- [ ] Управление sidebar
- [ ] Управление модальными окнами
- [ ] Автоскролл к новым сообщениям

### 3.6 Локализация (i18n.js)
- [ ] Объект строк RU/EN
- [ ] Функция получения строки по ключу
- [ ] Переключение языка
- [ ] Сохранение выбранного языка

### 3.7 Main App (app.js)
- [ ] Инициализация приложения
- [ ] Связывание модулей
- [ ] Обработка событий пользователя
- [ ] Game loop (показ сообщений, ожидание выбора)
- [ ] Загрузка демо-сценария при первом запуске

## Фаза 4: Контент

### 4.1 Демо-сценарий
- [ ] Написать простую историю с ветвлениями
- [ ] 3-5 узлов, 2-3 развилки
- [ ] Интересный сюжет для демонстрации
- [ ] Валидация по спецификации

### 4.2 Иконки
- [ ] Иконка меню (hamburger)
- [ ] Иконка перезапуска
- [ ] Иконка добавления
- [ ] Иконка настроек
- [ ] Иконка удаления
- [ ] Иконка редактирования

## Фаза 5: Полировка

### 5.1 Анимации
- [ ] Появление сообщений
- [ ] Typing indicator
- [ ] Открытие/закрытие sidebar
- [ ] Кнопки выбора
- [ ] Модальные окна

### 5.2 Мобильная адаптация
- [ ] Тестирование на разных размерах экрана
- [ ] Safe area для iPhone (notch)
- [ ] Touch-friendly размеры элементов
- [ ] Предотвращение zoom при фокусе на input

### 5.3 Обработка ошибок
- [ ] Ошибки парсинга сценария
- [ ] Ошибки localStorage
- [ ] Невалидные файлы при загрузке
- [ ] Понятные сообщения пользователю

### 5.4 Финальное тестирование
- [ ] Тест полного цикла: загрузка → игра → сохранение → перезапуск
- [ ] Тест всех веток демо-сценария
- [ ] Тест на Chrome, Firefox, Safari
- [ ] Тест на мобильных устройствах

## Приоритеты

**Критический путь (MVP):**
1. HTML каркас + базовые стили
2. Парсер YAML + Ink
3. Движок Ink
4. UI сообщений и выборов
5. Демо-сценарий

**После MVP:**
6. Sidebar и управление сценариями
7. Storage и автосохранение
8. Редактор сценариев
9. Локализация
10. Полировка и анимации

## Зависимости между задачами

```
HTML → CSS → UI Components
                ↓
Parser → Engine → App
                ↓
            Storage
                ↓
            i18n
```

## Оценка объема

- **Фаза 1**: Базовая
- **Фаза 2**: Средняя
- **Фаза 3**: Сложная (ядро)
- **Фаза 4**: Базовая
- **Фаза 5**: Средняя

## Статус проекта

**Текущая фаза**: Планирование завершено
**Следующий шаг**: Фаза 1.1 - HTML каркас
