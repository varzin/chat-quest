# Chat Quest - Messenger Quest Player

## Описание проекта
Веб-приложение для проигрывания интерактивных квест-сценариев в стиле мессенджера. Работает полностью в браузере без серверной части (HTML + CSS + JS).

## Технические требования
- **Платформа**: Чистый HTML5 + CSS3 + Vanilla JavaScript (ES6+)
- **Без сборки**: Работает напрямую в браузере без Node.js, Webpack и т.д.
- **Хранение данных**: localStorage для сценариев и прогресса
- **Адаптивность**: Mobile-first дизайн
- **Темы**: Purple glass-morphism (по умолчанию) + low contrast режим

## Архитектура

### Структура файлов
```
chat-quest/
├── index.html           # Единственный HTML файл
├── css/
│   └── styles.css       # Все стили (CSS Variables для темы)
├── js/
│   ├── app.js           # Главный модуль, инициализация
│   ├── parser.js        # Парсер YAML + Ink формата
│   ├── engine.js        # Движок выполнения Ink-сценария
│   ├── ui.js            # Управление UI компонентами
│   ├── storage.js       # Работа с localStorage
│   └── i18n.js          # Локализация RU/EN
├── scenarios/
│   └── demo.ink         # Предустановленный демо-сценарий
├── docs/
│   └── format-spec.md   # Спецификация формата файлов
└── assets/
    └── icons/           # SVG иконки
```

### Ключевые модули

#### parser.js
- Парсинг YAML front matter (без внешних библиотек)
- Парсинг Ink-синтаксиса (VAR, knots, choices, divert)
- Валидация структуры сценария

#### engine.js
- Выполнение Ink-сценария
- Управление переменной speaker
- Обработка choices и переходов
- Отслеживание состояния для сохранения

#### ui.js
- Рендеринг сообщений с glass-morphism эффектами
- Sidebar с списком сценариев
- Кнопки выбора внизу экрана (full-width backdrop)
- Typing indicator с задержкой по длине сообщения
- Модальные окна редактора и настроек
- Переключение между темами (purple/low contrast)

#### storage.js
- Сохранение/загрузка сценариев
- Автосохранение прогресса
- Управление списком сценариев

## UI Компоненты

### Основные экраны
1. **Chat View** - основной экран с диалогом
2. **Sidebar** - выдвигающееся меню со списком сценариев
3. **Editor Modal** - редактор сценария (textarea с подсветкой синтаксиса)
4. **Settings Modal** - настройки (тема, язык, очистка данных)

### Элементы чата
- Сообщения NPC (слева, полупрозрачный фиолетовый фон)
- Сообщения Player (справа, градиентный фиолетовый фон)
- Аватары персонажей
- Typing indicator (три точки с анимацией)
- Кнопки выбора (внизу, full-width backdrop с blur эффектом)
- Glass-morphism эффекты на всех элементах

## Формат сценариев
Файлы используют YAML front matter + Ink синтаксис.
Полная спецификация: `docs/format-spec.md`

## Локализация
Поддерживаемые языки: RU, EN
Строки UI хранятся в объекте i18n в `js/i18n.js`

## Стили и дизайн

### Цветовая палитра (Purple Glass-Morphism)
```css
/* Core Purple Palette */
--purple-deep: #0a0612;
--purple-dark: #1a0a2e;
--purple-vibrant: #9b30ff;
--purple-bright: #bf40ff;
--purple-glow: #d060ff;
--magenta-accent: #e040fb;

/* Backgrounds */
--bg-primary: #080410;
--bg-glass: rgba(45, 27, 78, 0.35);
--bg-message-npc: rgba(40, 25, 65, 0.75);
--bg-message-player: linear-gradient(135deg, #9b30ff 0%, #bf40ff 50%, #d060ff 100%);

/* Text */
--text-primary: #ffffff;
--text-secondary: rgba(200, 180, 220, 0.8);
--text-tertiary: rgba(160, 140, 180, 0.6);

/* Effects */
--blur-md: 16px;
--glow-purple: 0 0 60px rgba(155, 48, 255, 0.3);
```

### Low Contrast Theme
Альтернативная тема с пониженной контрастностью для комфортного использования.
Переключается через настройки (Settings → Theme).

### Типография
- Основной шрифт: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI'
- Размер сообщений: 17px
- Межстрочный интервал: 1.45
- Letter spacing: 0.01em

## Важные соглашения

### JavaScript
- ES6 модули (type="module")
- Без транспиляции, только современный синтаксис
- Строгий режим ('use strict')
- JSDoc комментарии для публичных функций

### CSS
- CSS Custom Properties для темизации
- BEM-подобное именование классов
- Mobile-first медиа-запросы
- Glass-morphism эффекты: backdrop-filter, rgba цвета, градиенты
- Поддержка нескольких тем через data-атрибуты

### Ink парсер
- Поддержка: VAR, knots (===), choices (+), divert (->), END
- Не поддерживается: stitches, tunnels, threads, lists, functions
- speaker устанавливается через ~ speaker = "id"

### Git workflow
- **КРИТИЧНО**: НИКОГДА не делать `git commit` без явной команды пользователя
- **КРИТИЧНО**: НИКОГДА не делать `git push` без явной команды пользователя
- Только когда пользователь явно попросит "коммит" или "commit" - создавать коммит
- Только когда пользователь явно попросит "пуш" или "push" - делать push
- Если нужно показать изменения - использовать только `git diff` или `git status`
- НЕ создавать коммиты автоматически после внесения изменений

## Команды разработки
Проект не требует сборки. Для разработки:
```bash
# Запуск локального сервера (любой статический сервер)
python3 -m http.server 8080
# или
npx serve .
```

## Тестирование
- Ручное тестирование в браузере
- Проверка на мобильных устройствах через DevTools
- Валидация сценариев через консоль браузера
