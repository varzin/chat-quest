# Chat Quest - Messenger Quest Player

## Описание проекта
Веб-приложение для проигрывания интерактивных квест-сценариев в стиле мессенджера (iMessage). Работает полностью в браузере без серверной части (HTML + CSS + JS).

## Технические требования
- **Платформа**: Чистый HTML5 + CSS3 + Vanilla JavaScript (ES6+)
- **Без сборки**: Работает напрямую в браузере без Node.js, Webpack и т.д.
- **Хранение данных**: localStorage для сценариев и прогресса
- **Адаптивность**: Mobile-first дизайн
- **Тема**: Dark mode в стиле iMessage

## Архитектура

### Структура файлов
```
chat-quest/
├── index.html           # Единственный HTML файл
├── css/
│   └── styles.css       # Все стили (CSS Variables для темы)
├── js/
│   ├── app.js           # Главный модуль, инициализация
│   ├── parser.js        # Парсер YAML + Ink формата
│   ├── engine.js        # Движок выполнения Ink-сценария
│   ├── ui.js            # Управление UI компонентами
│   ├── storage.js       # Работа с localStorage
│   └── i18n.js          # Локализация RU/EN
├── scenarios/
│   └── demo.ink         # Предустановленный демо-сценарий
├── docs/
│   └── format-spec.md   # Спецификация формата файлов
└── assets/
    └── icons/           # SVG иконки
```

### Ключевые модули

#### parser.js
- Парсинг YAML front matter (без внешних библиотек)
- Парсинг Ink-синтаксиса (VAR, knots, choices, divert)
- Валидация структуры сценария

#### engine.js
- Выполнение Ink-сценария
- Управление переменной speaker
- Обработка choices и переходов
- Отслеживание состояния для сохранения

#### ui.js
- Рендеринг сообщений в стиле iMessage
- Sidebar с списком сценариев
- Кнопки выбора внизу экрана
- Typing indicator с задержкой по длине сообщения
- Модальное окно редактора

#### storage.js
- Сохранение/загрузка сценариев
- Автосохранение прогресса
- Управление списком сценариев

## UI Компоненты

### Основные экраны
1. **Chat View** - основной экран с диалогом
2. **Sidebar** - выдвигающееся меню со списком сценариев
3. **Editor Modal** - редактор сценария (textarea)
4. **Settings** - настройки (язык, очистка данных)

### Элементы чата
- Сообщения NPC (слева, серый фон)
- Сообщения Player (справа, синий фон как в iMessage)
- Аватары персонажей
- Typing indicator (три точки с анимацией)
- Кнопки выбора (внизу, вместо поля ввода)

## Формат сценариев
Файлы используют YAML front matter + Ink синтаксис.
Полная спецификация: `docs/format-spec.md`

## Локализация
Поддерживаемые языки: RU, EN
Строки UI хранятся в объекте i18n в `js/i18n.js`

## Стили и дизайн

### Цветовая палитра (Dark theme)
```css
--bg-primary: #000000;
--bg-secondary: #1c1c1e;
--bg-message-npc: #3a3a3c;
--bg-message-player: #0a84ff;
--text-primary: #ffffff;
--text-secondary: #8e8e93;
```

### Типография
- Системный шрифт: -apple-system, BlinkMacSystemFont, 'Segoe UI'
- Размер сообщений: 17px
- Межстрочный интервал: 1.4

## Важные соглашения

### JavaScript
- ES6 модули (type="module")
- Без транспиляции, только современный синтаксис
- Строгий режим ('use strict')
- JSDoc комментарии для публичных функций

### CSS
- CSS Custom Properties для темизации
- BEM-подобное именование классов
- Mobile-first медиа-запросы

### Ink парсер
- Поддержка: VAR, knots (===), choices (+), divert (->), END
- Не поддерживается: stitches, tunnels, threads, lists, functions
- speaker устанавливается через ~ speaker = "id"

## Команды разработки
Проект не требует сборки. Для разработки:
```bash
# Запуск локального сервера (любой статический сервер)
python3 -m http.server 8080
# или
npx serve .
```

## Тестирование
- Ручное тестирование в браузере
- Проверка на мобильных устройствах через DevTools
- Валидация сценариев через консоль браузера
